import boto3
import json

def update_kms_policy(kms_key_id, new_role_arn):
    kms_client = boto3.client('kms')
    
    policy = kms_client.get_key_policy(
        KeyId=kms_key_id,
        PolicyName='default'
    )['Policy']
    
    policy_json = json.loads(policy)
    # Modify policy_json to add the new_role_arn to relevant sections
    
    updated_policy = json.dumps(policy_json)
    
    kms_client.put_key_policy(
        KeyId=kms_key_id,
        PolicyName='default',
        Policy=updated_policy
    )

def lambda_handler(event, context):
    for detail in event['detail']['resources']:
        if detail['resourceType'] == 'AWS::IAM::Role':
            new_role_arn = detail['ARN']
            kms_key_id = 'your-kms-key-id'
            
            update_kms_policy(kms_key_id, new_role_arn)
    
    return {
        'statusCode': 200,
        'body': 'KMS policy updated successfully'
    }
